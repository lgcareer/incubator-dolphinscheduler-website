<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="keywords" content="build-docker-image" />
  <meta name="description" content="build-docker-image" />
  <title>build-docker-image</title>
  <link rel="shortcut icon" href="/img/favicon.ico"/>
  <link rel="stylesheet" href="/build/docs.md.css" />
</head>
<body>
  <div id="root"><div class="md2html docs-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/en-us/index.html"><img class="logo" src="/img/hlogo_colorful.svg"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">中</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><div><ul class="ant-menu blackClass ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/index.html" target="_self">HOME</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-item-selected" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span class="submenu-title-wrapper"><a href="/en-us/docs/1.3.4/user_doc/quick-start.html" target="_self">DOCS</a><ul style="display:none"><li><a href="/en-us/docs/1.3.4/user_doc/quick-start.html" target="_self">1.3.4(Recommend)</a></li><li><a href="/en-us/docs/1.3.3/user_doc/quick-start.html" target="_self">1.3.3</a></li><li><a href="/en-us/docs/1.3.2/user_doc/quick-start.html" target="_self">1.3.2</a></li><li><a href="/en-us/docs/1.3.1/user_doc/quick-start.html" target="_self">1.3.1</a></li><li><a href="/en-us/docs/1.2.1/user_doc/quick-start.html" target="_self">1.2.1</a></li><li><a href="/en-us/docs/1.2.0/user_doc/quick-start.html" target="_self">1.2.0</a></li><li><a href="https://analysys.github.io/easyscheduler_docs_cn/" target="_self">1.1.0(Not Apache Release)</a></li></ul></span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/download/download.html" target="_self">DOWNLOAD</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/blog/index.html" target="_self">BLOG</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/development/development-environment-setup.html" target="_self">DEVELOPMENT</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/community/index.html" target="_self">COMMUNITY</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span class="submenu-title-wrapper"><a href="https://www.apache.org/" target="_blank">ASF</a><ul style="display:none"><li><a href="https://www.apache.org/" target="_blank">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank">License</a></li><li><a href="https://www.apache.org/events/current-event" target="_blank">Events</a></li><li><a href="https://www.apache.org/security/" target="_blank">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank">Thanks</a></li></ul></span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul></div></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>Documentation</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>Deployment Document</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.3.4/user_doc/hardware-environment.html" target="_self">Hardware Environment</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.3.4/user_doc/standalone-deployment.html" target="_self">Standalone Deployment</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.3.4/user_doc/cluster-deployment.html" target="_self">Cluster Deployment</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.3.4/user_doc/docker-deployment.html" target="_self">Docker Deployment</a></li></ul></li><li class="menu-item menu-item-level-1"><span>User Manual</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.3.4/user_doc/quick-start.html" target="_self">Quick Start</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.3.4/user_doc/system-manual.html" target="_self">User Manual</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.3.4/user_doc/metadata-1.3.html" target="_self">Metadata</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.3.4/user_doc/configuration-file.html" target="_self">Configuration File</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.3.4/user_doc/task-structure.html" target="_self">Task Structure</a></li></ul></li><li class="menu-item menu-item-level-1"><span>Api Document</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="http://106.75.43.194:8888/dolphinscheduler/doc.html?language=en&amp;lang=en" target="_blank">Api Document</a></li></ul></li><li class="menu-item menu-item-level-1"><span>Upgrade</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.3.4/user_doc/upgrade.html" target="_self">Upgrade</a></li></ul></li><li class="menu-item menu-item-level-1"><span>FAQ</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/release/faq.html" target="_self">FAQ</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h2>How to build a docker image</h2>
<p>You can build a docker image in A Unix-like operating system, You can also build it in Windows operating system.</p>
<p>In Unix-Like, Example:</p>
<pre><code class="language-bash">$ <span class="hljs-built_in">cd</span> path/incubator-dolphinscheduler
$ sh ./docker/build/hooks/build
</code></pre>
<p>In Windows, Example:</p>
<pre><code class="language-bat"><span class="hljs-function">c:\<span class="hljs-title">incubator</span>-<span class="hljs-title">dolphinscheduler</span>&gt;.\<span class="hljs-title">docker</span>\<span class="hljs-title">build</span>\<span class="hljs-title">hooks</span>\<span class="hljs-title">build.bat</span>
</span></code></pre>
<p>Please read <code>./docker/build/hooks/build</code> <code>./docker/build/hooks/build.bat</code> script files if you don't understand</p>
<h2>Environment Variables</h2>
<p>The Dolphin Scheduler image uses several environment variables which are easy to miss. While none of the variables are required, they may significantly aid you in using the image.</p>
<p><strong><code>DATABASE_TYPE</code></strong></p>
<p>This environment variable sets the type for database. The default value is <code>postgresql</code>.</p>
<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>
<p><strong><code>DATABASE_DRIVER</code></strong></p>
<p>This environment variable sets the type for database. The default value is <code>org.postgresql.Driver</code>.</p>
<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>
<p><strong><code>DATABASE_HOST</code></strong></p>
<p>This environment variable sets the host for database. The default value is <code>127.0.0.1</code>.</p>
<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>
<p><strong><code>DATABASE_PORT</code></strong></p>
<p>This environment variable sets the port for database. The default value is <code>5432</code>.</p>
<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>
<p><strong><code>DATABASE_USERNAME</code></strong></p>
<p>This environment variable sets the username for database. The default value is <code>root</code>.</p>
<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>
<p><strong><code>DATABASE_PASSWORD</code></strong></p>
<p>This environment variable sets the password for database. The default value is <code>root</code>.</p>
<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>
<p><strong><code>DATABASE_DATABASE</code></strong></p>
<p>This environment variable sets the database for database. The default value is <code>dolphinscheduler</code>.</p>
<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>
<p><strong><code>DATABASE_PARAMS</code></strong></p>
<p>This environment variable sets the database for database. The default value is <code>characterEncoding=utf8</code>.</p>
<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>
<p><strong><code>DOLPHINSCHEDULER_ENV_PATH</code></strong></p>
<p>This environment variable sets the runtime environment for task. The default value is <code>/opt/dolphinscheduler/conf/env/dolphinscheduler_env.sh</code>.</p>
<p><strong><code>DOLPHINSCHEDULER_DATA_BASEDIR_PATH</code></strong></p>
<p>User data directory path, self configuration, please make sure the directory exists and have read write permissions. The default value is <code>/tmp/dolphinscheduler</code></p>
<p><strong><code>ZOOKEEPER_QUORUM</code></strong></p>
<p>This environment variable sets zookeeper quorum for <code>master-server</code> and <code>worker-serverr</code>. The default value is <code>127.0.0.1:2181</code>.</p>
<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>.</p>
<p><strong><code>MASTER_EXEC_THREADS</code></strong></p>
<p>This environment variable sets exec thread num for <code>master-server</code>. The default value is <code>100</code>.</p>
<p><strong><code>MASTER_EXEC_TASK_NUM</code></strong></p>
<p>This environment variable sets exec task num for <code>master-server</code>. The default value is <code>20</code>.</p>
<p><strong><code>MASTER_HEARTBEAT_INTERVAL</code></strong></p>
<p>This environment variable sets heartbeat interval for <code>master-server</code>. The default value is <code>10</code>.</p>
<p><strong><code>MASTER_TASK_COMMIT_RETRYTIMES</code></strong></p>
<p>This environment variable sets task commit retry times for <code>master-server</code>. The default value is <code>5</code>.</p>
<p><strong><code>MASTER_TASK_COMMIT_INTERVAL</code></strong></p>
<p>This environment variable sets task commit interval for <code>master-server</code>. The default value is <code>1000</code>.</p>
<p><strong><code>MASTER_MAX_CPULOAD_AVG</code></strong></p>
<p>This environment variable sets max cpu load avg for <code>master-server</code>. The default value is <code>100</code>.</p>
<p><strong><code>MASTER_RESERVED_MEMORY</code></strong></p>
<p>This environment variable sets reserved memory for <code>master-server</code>. The default value is <code>0.1</code>.</p>
<p><strong><code>MASTER_LISTEN_PORT</code></strong></p>
<p>This environment variable sets port for <code>master-server</code>. The default value is <code>5678</code>.</p>
<p><strong><code>WORKER_EXEC_THREADS</code></strong></p>
<p>This environment variable sets exec thread num for <code>worker-server</code>. The default value is <code>100</code>.</p>
<p><strong><code>WORKER_HEARTBEAT_INTERVAL</code></strong></p>
<p>This environment variable sets heartbeat interval for <code>worker-server</code>. The default value is <code>10</code>.</p>
<p><strong><code>WORKER_FETCH_TASK_NUM</code></strong></p>
<p>This environment variable sets fetch task num for <code>worker-server</code>. The default value is <code>3</code>.</p>
<p><strong><code>WORKER_MAX_CPULOAD_AVG</code></strong></p>
<p>This environment variable sets max cpu load avg for <code>worker-server</code>. The default value is <code>100</code>.</p>
<p><strong><code>WORKER_RESERVED_MEMORY</code></strong></p>
<p>This environment variable sets reserved memory for <code>worker-server</code>. The default value is <code>0.1</code>.</p>
<p><strong><code>WORKER_WEIGHT</code></strong></p>
<p>This environment variable sets port for <code>worker-server</code>. The default value is <code>100</code>.</p>
<p><strong><code>WORKER_LISTEN_PORT</code></strong></p>
<p>This environment variable sets port for <code>worker-server</code>. The default value is <code>1234</code>.</p>
<p><strong><code>WORKER_GROUP</code></strong></p>
<p>This environment variable sets group for <code>worker-server</code>. The default value is <code>default</code>.</p>
<p><strong><code>XLS_FILE_PATH</code></strong></p>
<p>This environment variable sets xls file path for <code>alert-server</code>. The default value is <code>/tmp/xls</code>.</p>
<p><strong><code>MAIL_SERVER_HOST</code></strong></p>
<p>This environment variable sets mail server host for <code>alert-server</code>. The default value is empty.</p>
<p><strong><code>MAIL_SERVER_PORT</code></strong></p>
<p>This environment variable sets mail server port for <code>alert-server</code>. The default value is empty.</p>
<p><strong><code>MAIL_SENDER</code></strong></p>
<p>This environment variable sets mail sender for <code>alert-server</code>. The default value is empty.</p>
<p><strong><code>MAIL_USER=</code></strong></p>
<p>This environment variable sets mail user for <code>alert-server</code>. The default value is empty.</p>
<p><strong><code>MAIL_PASSWD</code></strong></p>
<p>This environment variable sets mail password for <code>alert-server</code>. The default value is empty.</p>
<p><strong><code>MAIL_SMTP_STARTTLS_ENABLE</code></strong></p>
<p>This environment variable sets SMTP tls for <code>alert-server</code>. The default value is <code>true</code>.</p>
<p><strong><code>MAIL_SMTP_SSL_ENABLE</code></strong></p>
<p>This environment variable sets SMTP ssl for <code>alert-server</code>. The default value is <code>false</code>.</p>
<p><strong><code>MAIL_SMTP_SSL_TRUST</code></strong></p>
<p>This environment variable sets SMTP ssl truest for <code>alert-server</code>. The default value is empty.</p>
<p><strong><code>ENTERPRISE_WECHAT_ENABLE</code></strong></p>
<p>This environment variable sets enterprise wechat enable for <code>alert-server</code>. The default value is <code>false</code>.</p>
<p><strong><code>ENTERPRISE_WECHAT_CORP_ID</code></strong></p>
<p>This environment variable sets enterprise wechat corp id for <code>alert-server</code>. The default value is empty.</p>
<p><strong><code>ENTERPRISE_WECHAT_SECRET</code></strong></p>
<p>This environment variable sets enterprise wechat secret for <code>alert-server</code>. The default value is empty.</p>
<p><strong><code>ENTERPRISE_WECHAT_AGENT_ID</code></strong></p>
<p>This environment variable sets enterprise wechat agent id for <code>alert-server</code>. The default value is empty.</p>
<p><strong><code>ENTERPRISE_WECHAT_USERS</code></strong></p>
<p>This environment variable sets enterprise wechat users for <code>alert-server</code>. The default value is empty.</p>
<p><strong><code>FRONTEND_API_SERVER_HOST</code></strong></p>
<p>This environment variable sets api server host for <code>frontend</code>. The default value is <code>127.0.0.1</code>.</p>
<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>api-server</code>.</p>
<p><strong><code>FRONTEND_API_SERVER_PORT</code></strong></p>
<p>This environment variable sets api server port for <code>frontend</code>. The default value is <code>123451</code>.</p>
<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>api-server</code>.</p>
<h2>Initialization scripts</h2>
<p>If you would like to do additional initialization in an image derived from this one, add one or more environment variable under <code>/root/start-init-conf.sh</code>, and modify template files in <code>/opt/dolphinscheduler/conf/*.tpl</code>.</p>
<p>For example, to add an environment variable <code>API_SERVER_PORT</code> in <code>/root/start-init-conf.sh</code>:</p>
<pre><code>export API_SERVER_PORT=5555
</code></pre>
<p>and to modify <code>/opt/dolphinscheduler/conf/application-api.properties.tpl</code> template file, add server port:</p>
<pre><code>server.port=${API_SERVER_PORT}
</code></pre>
<p><code>/root/start-init-conf.sh</code> will dynamically generate config file:</p>
<pre><code class="language-sh"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;generate app config&quot;</span>
ls <span class="hljs-variable">${DOLPHINSCHEDULER_HOME}</span>/conf/ | grep <span class="hljs-string">&quot;.tpl&quot;</span> | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line; <span class="hljs-keyword">do</span>
<span class="hljs-built_in">eval</span> <span class="hljs-string">&quot;cat &lt;&lt; EOF
<span class="hljs-subst">$(cat ${DOLPHINSCHEDULER_HOME}/conf/${line})</span>
EOF
&quot;</span> &gt; <span class="hljs-variable">${DOLPHINSCHEDULER_HOME}</span>/conf/<span class="hljs-variable">${line%.*}</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;generate nginx config&quot;</span>
sed -i <span class="hljs-string">&quot;s/FRONTEND_API_SERVER_HOST/<span class="hljs-variable">${FRONTEND_API_SERVER_HOST}</span>/g&quot;</span> /etc/nginx/conf.d/dolphinscheduler.conf
sed -i <span class="hljs-string">&quot;s/FRONTEND_API_SERVER_PORT/<span class="hljs-variable">${FRONTEND_API_SERVER_PORT}</span>/g&quot;</span> /etc/nginx/conf.d/dolphinscheduler.conf
</code></pre>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/ds_gray.svg"/><div class="cols-container"><div class="col col-12"><h3>Disclaimer</h3><p>Apache DolphinScheduler is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p></div><div class="col col-6"><dl><dt>Documentation</dt><dd><a href="/en-us/development/architecture-design.html" target="_self">Overview</a></dd><dd><a href="/en-us/docs/1.3.4/user_doc/quick-start.html" target="_self">Quick start</a></dd><dd><a href="/en-us/development/backend-development.html" target="_self">Developer guide</a></dd></dl></div><div class="col col-6"><dl><dt>ASF</dt><dd><a href="http://www.apache.org" target="_self">Foundation</a></dd><dd><a href="http://www.apache.org/licenses/" target="_self">License</a></dd><dd><a href="http://www.apache.org/events/current-event" target="_self">Events</a></dd><dd><a href="http://www.apache.org/foundation/sponsorship.html" target="_self">Sponsorship</a></dd><dd><a href="http://www.apache.org/foundation/thanks.html" target="_self">Thanks</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2019-2021 The Apache Software Foundation. Apache DolphinScheduler, DolphinScheduler, and its feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
  <script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
  <script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
  <script>window.rootPath = '';</script>
  <script src="/build/docs.md.js"></script>
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?4e7b4b400dd31fa015018a435c64d06f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
</body>
</html>