{
  "filename": "build-docker-image.md",
  "__html": "<h2>How to build a docker image</h2>\n<p>You can build a docker image in A Unix-like operating system, You can also build it in Windows operating system.</p>\n<p>In Unix-Like, Example:</p>\n<pre><code class=\"language-bash\">$ <span class=\"hljs-built_in\">cd</span> path/incubator-dolphinscheduler\n$ sh ./docker/build/hooks/build\n</code></pre>\n<p>In Windows, Example:</p>\n<pre><code class=\"language-bat\"><span class=\"hljs-function\">c:\\<span class=\"hljs-title\">incubator</span>-<span class=\"hljs-title\">dolphinscheduler</span>&gt;.\\<span class=\"hljs-title\">docker</span>\\<span class=\"hljs-title\">build</span>\\<span class=\"hljs-title\">hooks</span>\\<span class=\"hljs-title\">build.bat</span>\n</span></code></pre>\n<p>Please read <code>./docker/build/hooks/build</code> <code>./docker/build/hooks/build.bat</code> script files if you don't understand</p>\n<h2>Environment Variables</h2>\n<p>The Dolphin Scheduler image uses several environment variables which are easy to miss. While none of the variables are required, they may significantly aid you in using the image.</p>\n<p><strong><code>DATABASE_TYPE</code></strong></p>\n<p>This environment variable sets the type for database. The default value is <code>postgresql</code>.</p>\n<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>\n<p><strong><code>DATABASE_DRIVER</code></strong></p>\n<p>This environment variable sets the type for database. The default value is <code>org.postgresql.Driver</code>.</p>\n<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>\n<p><strong><code>DATABASE_HOST</code></strong></p>\n<p>This environment variable sets the host for database. The default value is <code>127.0.0.1</code>.</p>\n<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>\n<p><strong><code>DATABASE_PORT</code></strong></p>\n<p>This environment variable sets the port for database. The default value is <code>5432</code>.</p>\n<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>\n<p><strong><code>DATABASE_USERNAME</code></strong></p>\n<p>This environment variable sets the username for database. The default value is <code>root</code>.</p>\n<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>\n<p><strong><code>DATABASE_PASSWORD</code></strong></p>\n<p>This environment variable sets the password for database. The default value is <code>root</code>.</p>\n<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>\n<p><strong><code>DATABASE_DATABASE</code></strong></p>\n<p>This environment variable sets the database for database. The default value is <code>dolphinscheduler</code>.</p>\n<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>\n<p><strong><code>DATABASE_PARAMS</code></strong></p>\n<p>This environment variable sets the database for database. The default value is <code>characterEncoding=utf8</code>.</p>\n<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>, <code>api-server</code>, <code>alert-server</code>.</p>\n<p><strong><code>DOLPHINSCHEDULER_ENV_PATH</code></strong></p>\n<p>This environment variable sets the runtime environment for task. The default value is <code>/opt/dolphinscheduler/conf/env/dolphinscheduler_env.sh</code>.</p>\n<p><strong><code>DOLPHINSCHEDULER_DATA_BASEDIR_PATH</code></strong></p>\n<p>User data directory path, self configuration, please make sure the directory exists and have read write permissions. The default value is <code>/tmp/dolphinscheduler</code></p>\n<p><strong><code>ZOOKEEPER_QUORUM</code></strong></p>\n<p>This environment variable sets zookeeper quorum for <code>master-server</code> and <code>worker-serverr</code>. The default value is <code>127.0.0.1:2181</code>.</p>\n<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>master-server</code>, <code>worker-server</code>.</p>\n<p><strong><code>MASTER_EXEC_THREADS</code></strong></p>\n<p>This environment variable sets exec thread num for <code>master-server</code>. The default value is <code>100</code>.</p>\n<p><strong><code>MASTER_EXEC_TASK_NUM</code></strong></p>\n<p>This environment variable sets exec task num for <code>master-server</code>. The default value is <code>20</code>.</p>\n<p><strong><code>MASTER_HEARTBEAT_INTERVAL</code></strong></p>\n<p>This environment variable sets heartbeat interval for <code>master-server</code>. The default value is <code>10</code>.</p>\n<p><strong><code>MASTER_TASK_COMMIT_RETRYTIMES</code></strong></p>\n<p>This environment variable sets task commit retry times for <code>master-server</code>. The default value is <code>5</code>.</p>\n<p><strong><code>MASTER_TASK_COMMIT_INTERVAL</code></strong></p>\n<p>This environment variable sets task commit interval for <code>master-server</code>. The default value is <code>1000</code>.</p>\n<p><strong><code>MASTER_MAX_CPULOAD_AVG</code></strong></p>\n<p>This environment variable sets max cpu load avg for <code>master-server</code>. The default value is <code>100</code>.</p>\n<p><strong><code>MASTER_RESERVED_MEMORY</code></strong></p>\n<p>This environment variable sets reserved memory for <code>master-server</code>. The default value is <code>0.1</code>.</p>\n<p><strong><code>MASTER_LISTEN_PORT</code></strong></p>\n<p>This environment variable sets port for <code>master-server</code>. The default value is <code>5678</code>.</p>\n<p><strong><code>WORKER_EXEC_THREADS</code></strong></p>\n<p>This environment variable sets exec thread num for <code>worker-server</code>. The default value is <code>100</code>.</p>\n<p><strong><code>WORKER_HEARTBEAT_INTERVAL</code></strong></p>\n<p>This environment variable sets heartbeat interval for <code>worker-server</code>. The default value is <code>10</code>.</p>\n<p><strong><code>WORKER_FETCH_TASK_NUM</code></strong></p>\n<p>This environment variable sets fetch task num for <code>worker-server</code>. The default value is <code>3</code>.</p>\n<p><strong><code>WORKER_MAX_CPULOAD_AVG</code></strong></p>\n<p>This environment variable sets max cpu load avg for <code>worker-server</code>. The default value is <code>100</code>.</p>\n<p><strong><code>WORKER_RESERVED_MEMORY</code></strong></p>\n<p>This environment variable sets reserved memory for <code>worker-server</code>. The default value is <code>0.1</code>.</p>\n<p><strong><code>WORKER_WEIGHT</code></strong></p>\n<p>This environment variable sets port for <code>worker-server</code>. The default value is <code>100</code>.</p>\n<p><strong><code>WORKER_LISTEN_PORT</code></strong></p>\n<p>This environment variable sets port for <code>worker-server</code>. The default value is <code>1234</code>.</p>\n<p><strong><code>WORKER_GROUP</code></strong></p>\n<p>This environment variable sets group for <code>worker-server</code>. The default value is <code>default</code>.</p>\n<p><strong><code>XLS_FILE_PATH</code></strong></p>\n<p>This environment variable sets xls file path for <code>alert-server</code>. The default value is <code>/tmp/xls</code>.</p>\n<p><strong><code>MAIL_SERVER_HOST</code></strong></p>\n<p>This environment variable sets mail server host for <code>alert-server</code>. The default value is empty.</p>\n<p><strong><code>MAIL_SERVER_PORT</code></strong></p>\n<p>This environment variable sets mail server port for <code>alert-server</code>. The default value is empty.</p>\n<p><strong><code>MAIL_SENDER</code></strong></p>\n<p>This environment variable sets mail sender for <code>alert-server</code>. The default value is empty.</p>\n<p><strong><code>MAIL_USER=</code></strong></p>\n<p>This environment variable sets mail user for <code>alert-server</code>. The default value is empty.</p>\n<p><strong><code>MAIL_PASSWD</code></strong></p>\n<p>This environment variable sets mail password for <code>alert-server</code>. The default value is empty.</p>\n<p><strong><code>MAIL_SMTP_STARTTLS_ENABLE</code></strong></p>\n<p>This environment variable sets SMTP tls for <code>alert-server</code>. The default value is <code>true</code>.</p>\n<p><strong><code>MAIL_SMTP_SSL_ENABLE</code></strong></p>\n<p>This environment variable sets SMTP ssl for <code>alert-server</code>. The default value is <code>false</code>.</p>\n<p><strong><code>MAIL_SMTP_SSL_TRUST</code></strong></p>\n<p>This environment variable sets SMTP ssl truest for <code>alert-server</code>. The default value is empty.</p>\n<p><strong><code>ENTERPRISE_WECHAT_ENABLE</code></strong></p>\n<p>This environment variable sets enterprise wechat enable for <code>alert-server</code>. The default value is <code>false</code>.</p>\n<p><strong><code>ENTERPRISE_WECHAT_CORP_ID</code></strong></p>\n<p>This environment variable sets enterprise wechat corp id for <code>alert-server</code>. The default value is empty.</p>\n<p><strong><code>ENTERPRISE_WECHAT_SECRET</code></strong></p>\n<p>This environment variable sets enterprise wechat secret for <code>alert-server</code>. The default value is empty.</p>\n<p><strong><code>ENTERPRISE_WECHAT_AGENT_ID</code></strong></p>\n<p>This environment variable sets enterprise wechat agent id for <code>alert-server</code>. The default value is empty.</p>\n<p><strong><code>ENTERPRISE_WECHAT_USERS</code></strong></p>\n<p>This environment variable sets enterprise wechat users for <code>alert-server</code>. The default value is empty.</p>\n<p><strong><code>FRONTEND_API_SERVER_HOST</code></strong></p>\n<p>This environment variable sets api server host for <code>frontend</code>. The default value is <code>127.0.0.1</code>.</p>\n<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>api-server</code>.</p>\n<p><strong><code>FRONTEND_API_SERVER_PORT</code></strong></p>\n<p>This environment variable sets api server port for <code>frontend</code>. The default value is <code>123451</code>.</p>\n<p><strong>Note</strong>: You must be specify it when start a standalone dolphinscheduler server. Like <code>api-server</code>.</p>\n<h2>Initialization scripts</h2>\n<p>If you would like to do additional initialization in an image derived from this one, add one or more environment variable under <code>/root/start-init-conf.sh</code>, and modify template files in <code>/opt/dolphinscheduler/conf/*.tpl</code>.</p>\n<p>For example, to add an environment variable <code>API_SERVER_PORT</code> in <code>/root/start-init-conf.sh</code>:</p>\n<pre><code>export API_SERVER_PORT=5555\n</code></pre>\n<p>and to modify <code>/opt/dolphinscheduler/conf/application-api.properties.tpl</code> template file, add server port:</p>\n<pre><code>server.port=${API_SERVER_PORT}\n</code></pre>\n<p><code>/root/start-init-conf.sh</code> will dynamically generate config file:</p>\n<pre><code class=\"language-sh\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;generate app config&quot;</span>\nls <span class=\"hljs-variable\">${DOLPHINSCHEDULER_HOME}</span>/conf/ | grep <span class=\"hljs-string\">&quot;.tpl&quot;</span> | <span class=\"hljs-keyword\">while</span> <span class=\"hljs-built_in\">read</span> line; <span class=\"hljs-keyword\">do</span>\n<span class=\"hljs-built_in\">eval</span> <span class=\"hljs-string\">&quot;cat &lt;&lt; EOF\n<span class=\"hljs-subst\">$(cat ${DOLPHINSCHEDULER_HOME}/conf/${line})</span>\nEOF\n&quot;</span> &gt; <span class=\"hljs-variable\">${DOLPHINSCHEDULER_HOME}</span>/conf/<span class=\"hljs-variable\">${line%.*}</span>\n<span class=\"hljs-keyword\">done</span>\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;generate nginx config&quot;</span>\nsed -i <span class=\"hljs-string\">&quot;s/FRONTEND_API_SERVER_HOST/<span class=\"hljs-variable\">${FRONTEND_API_SERVER_HOST}</span>/g&quot;</span> /etc/nginx/conf.d/dolphinscheduler.conf\nsed -i <span class=\"hljs-string\">&quot;s/FRONTEND_API_SERVER_PORT/<span class=\"hljs-variable\">${FRONTEND_API_SERVER_PORT}</span>/g&quot;</span> /etc/nginx/conf.d/dolphinscheduler.conf\n</code></pre>\n",
  "link": "/dist/en-us/docs/1.3.4/user_doc/build-docker-image.html",
  "meta": {}
}